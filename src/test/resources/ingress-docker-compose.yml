# This docker-compose file will stand up the ingress app, kafka, zookeeper, and a minio storage app
# You can add your own app to this docker-compose file and stand it up as part of the stack
version: "3"
services:
  minio:
      image: minio/minio
      command: server /data
      volumes:
        - '$MINIO_DATA_DIR:/data:Z'
        - '$MINIO_CONFIG_DIR:/root/.minio:Z'
      ports:
        - 9000:9000
      environment:
        - MINIO_ACCESS_KEY=$MINIO_ACCESS_KEY
        - MINIO_SECRET_KEY=$MINIO_SECRET_KEY
  createbuckets:
    image: minio/mc
    depends_on:
      - minio
    entrypoint: >
      /bin/sh -c "
      /usr/bin/mc config host add myminio http://minio:9000 $MINIO_ACCESS_KEY $MINIO_SECRET_KEY;
      /usr/bin/mc mb myminio/insights-upload-perma;
      /usr/bin/mc mb myminio/insights-upload-rejected;
      /usr/bin/mc policy download myminio/insights-upload-perma;
      /usr/bin/mc policy download myminio/insights-upload-rejected;
      exit 0;
      "
  ingress:
    build: .
    ports:
      - 8080:3000
    environment:
      - AWS_ACCESS_KEY_ID=$MINIO_ACCESS_KEY
      - AWS_SECRET_ACCESS_KEY=$MINIO_SECRET_KEY
      - AWS_REGION=us-east-1
      - INGRESS_STAGEBUCKET=insights-upload-perma
      - INGRESS_REJECTBUCKET=insights-upload-rejected
      - INGRESS_INVENTORYURL=http://inventory:8080/api/inventory/v1/hosts
      - INGRESS_VALIDTOPICS=xavier,testareno,advisortestareno,advisor #if you test a different topic, add it here
      - OPENSHIFT_BUILD_COMMIT=woopwoop
      - INGRESS_MINIODEV=true
      - INGRESS_MINIOACCESSKEY=$MINIO_ACCESS_KEY
      - INGRESS_MINIOSECRETKEY=$MINIO_SECRET_KEY
      - INGRESS_MINIOENDPOINT=minio:9000





21:24:02.712 [tc-okhttp-stream-497479191] INFO  o.j.xavier.integrations.EndToEndTest - [INGRESS-LOG] STDOUT:
  {"@timestamp":"2019-11-16T20:17:11.01Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}
    {"@timestamp":"2019-11-16T20:17:19.412Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}
    {"@timestamp":"2019-11-16T20:17:27.814Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}
    {"@timestamp":"2019-11-16T20:17:36.216Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:17:44.618Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:17:53.021Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:18:01.423Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:18:09.825Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:18:18.227Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:18:26.629Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:18:35.031Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:18:43.434Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:18:51.835Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:00.238Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:08.64Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:17.042Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:25.444Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:33.846Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:42.248Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:50.651Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:19:59.053Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:20:07.455Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:20:15.856Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:20:24.258Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:20:32.66Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:20:41.061Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:20:49.464Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:20:57.865Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:21:06.267Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:21:14.669Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:21:23.071Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:21:31.473Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:21:39.876Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:21:48.278Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:21:56.68Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:22:05.082Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:22:13.483Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:22:21.886Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:22:30.288Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:22:38.69Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:22:47.092Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:22:55.494Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:23:03.897Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:23:12.299Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:23:20.701Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:23:29.103Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:23:37.505Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:23:45.907Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:23:54.308Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress-go/queue.Producer.func1","error":"dial tcp 127.0.0.1:36049: connect: connection refused","levelname":"error","message":"error while writing, putting message back into the channel","source_host":"a45e1bccde5e"}{"@timestamp":"2019-11-16T20:24:02.71Z","@version":1,"app":"ingress","caller":"github.com/redhatinsights/insights-ingress
